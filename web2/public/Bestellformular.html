<!DOCTYPE html>
<html lang="en">

<head>
  <title>LSSD Custom Cars</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="jquery/jquery-3.5.1.min.js"></script>
  <link rel="stylesheet" href="css/stylesheet.css">
  <script type="text/javascript" src="scripts/scripts.js"></script>
  <script src="popperJS/popper.min.js"></script>
  <script src="Bootstrap/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="Bootstrap/css/bootstrap.min.css">
</head>

<body style="background-color:#282c34">
  
  <nav class="navbar navbar-expand-md  navbar-dark">
    <div class="navbar-brand"><a href="index.html"><img id="logo" src="img/logo.png" alt="logo.png"></a></div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="collapsibleNavbar">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="index.html">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="Konfigurator.html">Autos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="Events.html">Events</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="Kontakt.html">Kontakt</a>
        </li>
        <li class="nav-item">
			<div class="container" id="shopping_cart">
				<img id="shopping_cart" src="./img/shopping_cart_white.png" alt="Warenkorb" data-html="true"
				data-toggle="popover" data-placement="bottom" title='<h1>Warenkorb</h1>'
				data-content="">
			  </div>
        </li>
      </ul>
    </div>
  </nav>
	<div class="container bestellformular_top_spacer">
		<div>
			<h1>Bestellung</h1>
		</div>
		<div class="row">
			<div class="col-md-2">
			</div>
			<div class="col-md-8">
        <img src="./img/slideshow_skyline.jpg" class="img-fluid" id="skyline" alt="Responsive image">
        <img src="./img/slideshow_911.jpg" class="img-fluid" id="porsche" alt="Responsive image">
        <img src="./img/slideshow_corvette.jpg" class="img-fluid" id="corvette" alt="Responsive image">
			</div>
		
		</div>
	</div>
  
	<div class="test">
		<div class="row">
			<div class="col-md-7">
			<div class="row">
			<div class="col-md-4">
			</div>
			<div class="col-md-6">
			<div class="bestellformular_top_spacer bestellformular_warenkorb">
					<h5>
						<ul id="myList1" class="config_price"><li>name</li><li>Basispreis</li><li>Titan Silber: Preis 500€</li><li>Motor: Standard  Preis: 0€</li><li>Fahrwerk: Standard  Preis: 0€</li><li>Sportfelgen: Standard  Preis: 0€</li><li>Update: Standard  Preis: 0€</li><li class="grey"><p id="endpreis" >Endpreis:  73083,48€</p></li></ul>
						
					<p class="font-weight-bold ">Versandart: Nur Abholung möglich </p>
				</h5>
			</div>
			</div>
			</div>
	</div>
	<div class="col-md-5 bestellformular_padding_top">
		<form method="POST" enctype="multipart/form-data" id="myform" class="needs-validation" novalidate method="post"
          id="BookPackageForm"></form>>
       
        <div class="form-row">
          <div class="form-group col-md-4">
            <label id="Event_Form_Text">Name</label>
            <span style="color:red">*</span>
            <input type="text" class="form-control" id="name" required>
          </div>
          <div class="form-group col-md-4">
            <label id="Event_Form_Text">Vorname</label>
            <span style="color:red">*</span>
            <input type="text" class="form-control" id="vname" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-8">
            <label id="Event_Form_Text">E-Mail</label>
            <span style="color:red">*</span>
            <input type="text" class="form-control" id="email" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-8">
            <label for="validationDefault03" id="Event_Form_Text">Adresse</label>
            
            <input type="text" id="adr" class="form-control">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-2">
            
            <label id="Event_Form_Text">PLZ</label>
           
            <input type="text" id="plz" class="form-control">
          </div>
          <div class="form-group col-md-4">
            
            <label id="Event_Form_Text">Ort</label>
           
            <input type="text" id="Ort" class="form-control">
            </select>
          </div>
          
          <div class="form-group col-md-2">
            
            <a class="btn btn-success" type="submit"  id="Event_button"
              role="button">Absenden</a>
          </div>
        </div>
        </form>
		  
  	
	</div>
	</div>
	</div class="bestellformular_sizer">
	<br><br>
	</div>
</div>

<footer>
	<div class="row ">
	  <div class="col-md-1">
	  </div>
	  <div class="col-md-3">
		<p class="footer_head"><b>Über uns</b></p>
		<p class="footer_text" style="font-size:18px">
		  LSSD Custom Cars ist ein junges und dynamisches Unternehmen mit dem Hauptsitz in Albstadt-Ebingen.
		  Unser Unternehmen besteht aus 10 Mitarbeitern, die im Verkauf, Beratung und der Werkstatt tätig sind.
		  Dabei ist es unser Ziel Ihnen ausgewählte Autos anzubieten, die sie individuell konfigurieren können.
		</p>
	  </div>
	  <div class="col-md-3">
		<p class="footer_head"><b>Neuigkeiten</b></p>
		<p class="footer_text" style="font-size:18px">
		  Mometan können wir Ihnen auf Grund der aktuellen Lage nur ein eingeschränktes Angebot
		  an Autos anbieten.<br><br>
		  Wir bitten um Entschuldigung und hoffen, dass wir Ihnen bald möglichst wieder unser volles Angebot bieten können.
		</p>
	  </div>
	  <div class="col-md-3">
		<p class="footer_head"><b>Kontakt</b></p>
		<p class="footer_text" style="font-size:18px">
		  LSSD Custom Cars<br>
		  Poststraße 6<br>
		  72458 Albstadt<br>
		  07571/445566<br><br>
		  <a href='Kontakt.html'>Kontakt/Termin</a>
		  <br>
		  <a href='impressum.html'>Impressum</a>
		</p>
	  </div>
	  <div class="col-md-2">
	  </div>
	</div>
  </footer>
  <script>
    function getCookie() {
          console.log("getCookie ");
        var nameEQ = "carID" + "=";
        var ca = document.cookie.split(';');
        for(var i=0;i < ca.length;i++) {
             var c = ca[i];
             while (c.charAt(0)==' ') c = c.substring(1,c.length);
             if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        
        return null;
    }
    function setCockieWaren(){
      var date = new Date();
        date.setTime(date.getTime() + (1*24*60*60*1000));
        expires = "; expires=" + date.toUTCString();
      document.cookie =  "warenkorb" + "=" + 3 + expires;

    }

    function getCookieWare() {
          console.log("getCookie ");
        var nameEQ = "warenkorb" + "=";
        var ca = document.cookie.split(';');
        for(var i=0;i < ca.length;i++) {
             var c = ca[i];
             while (c.charAt(0)==' ') c = c.substring(1,c.length);
             if (c.indexOf(nameEQ) == 0) return slideTo = c.substring(nameEQ.length,c.length);
        }
        
        return null;
    }

    var x = getCookieWare();
    
    switch (x) {
  case "1":
  var c = "<div><h5><p>Um eine Bestellung aufzugeben, klicken Sie den Button.</p> <a class='btn btn-primary' href='Konfigurator.html' role='button'>Bestellung beginnen </a> </div>"
  $('[data-toggle="popover"]').attr('data-content', c);
  break;
  case "2":
  var c = "<div><h5><p>Um eine Bestellung fort zufahren, klicken Sie den Button.</p> <a class='btn btn-primary' href='Bestellformular.html' role='button'>Bestellung fortsetzen</a> </div>"
  $('[data-toggle="popover"]').attr('data-content', c);
  break;
  case "3":
  var c = "<div><h5><p>Um eine Bestellung abzuschließen, klicken Sie den Button.</p> <a class='btn btn-primary' href='Bestellbestaetigung.html' role='button'>Bestellung abschließen</a> </div>"
  $('[data-toggle="popover"]').attr('data-content', c);
 
  break;
    }

    function setImg(id){
      console.log("setImg "+id);
      switch (id) {
  case "1":
  document.getElementById("skyline").style.display = "none";
  document.getElementById("porsche").style.display = "block";
  document.getElementById("corvette").style.display = "none";
  break;
  case "2":
    console.log("case 2");
  document.getElementById("skyline").style.display = "none";
  document.getElementById("porsche").style.display = "none";
  document.getElementById("corvette").style.display = "block";
  break;
  case "3":
  console.log("case 3");
  document.getElementById("skyline").style.display = "block";
  document.getElementById("porsche").style.display = "none";
  document.getElementById("corvette").style.display = "none";
  break;
    }
  }



  
	var ret ={};
    $(document).ready(function () {
      setImg(getCookie());
	  $('[data-toggle="popover"]').popover();
	  
	  $.ajax({
        url: "http://localhost:8000/api/config/subSelc",
        method: "get",
        dataType: "json"
      }).done(function (response) {
		ret=response.daten;
		console.log("debug 189  ++++"+ret.id);
      }).fail(function (jqXHR, statusText, error) {
        console.log("Response Code: " + jqXHR.status + " - Fehlermeldung: " + jqXHR.responseText);
		$("#Farbe").html("Ein Fehler ist aufgetreten");
		

	  });
	  
	  
	var ajaxFn = function() { 
	console.log("debug ret   "+ret.id);
      $.ajax({
          url: "http://localhost:8000/api/motor/gib/" +ret.f_id_motor,
          method: "get",
          dataType: "json"
        }).done(function (response) {
			
        
          for (var obj in response.daten) {
            if (obj != "preis") {
              var textnode = document.createTextNode(response.daten.name);
              var item = document.getElementById("myList1").childNodes[0];
              //  item.replaceChild(textnode, item.childNodes[0]);
            } else {
              var price = response.daten[obj].toString();
              price = response.daten.name+ "\n Preis: " + price + "€";
              
              var textnode = document.createTextNode(price);
              var item = document.getElementById("myList1").childNodes[3];
               item.replaceChild(textnode, item.childNodes[0]);
            }
           
          };

        }).fail(function (jqXHR, statusText, error) {
          console.log("Response Code: " + jqXHR.status + " - Fehlermeldung: " + jqXHR.responseText);
          $("#Farbe").html("Ein Fehler ist aufgetreten");
		});
		
		$.ajax({
          url: "http://localhost:8000/api/auto/gib/" + ret.f_id_auto,
          method: "get",
          dataType: "json"
        }).done(function (response) {
       
          for (var obj in response.daten) {
            if (obj != "preis") {
              var textnode = document.createTextNode(response.daten.name);
              var item = document.getElementById("myList1").childNodes[0];
               item.replaceChild(textnode, item.childNodes[0]);
            } else {
              var price = response.daten[obj].toString();
              price = "Basispreis: " + price + "€";
              
              var textnode = document.createTextNode(price);
              var item = document.getElementById("myList1").childNodes[1];
               item.replaceChild(textnode, item.childNodes[0]);
            }
           
          };
        
        }).fail(function (jqXHR, statusText, error) {
          console.log("Response Code: " + jqXHR.status + " - Fehlermeldung: " + jqXHR.responseText);
          $("#Farbe").html("Ein Fehler ist aufgetreten");
        });
      
		$.ajax({
          url: "http://localhost:8000/api/fahrwerk/gib/" + ret.f_id_fahrwerk,
          method: "get",
          dataType: "json"
        }).done(function (response) {
       
          for (var obj in response.daten) {
            if (obj != "preis") {
              var textnode = document.createTextNode(response.daten.hersteller);
              var item = document.getElementById("myList1").childNodes[0];
             
            } else {
              var price = response.daten[obj].toString();
              price = response.daten.hersteller+ "\n Preis: " + price + "€";
              
              var textnode = document.createTextNode(price);
              var item = document.getElementById("myList1").childNodes[4];
               item.replaceChild(textnode, item.childNodes[0]);
            }
           
          };
        
        }).fail(function (jqXHR, statusText, error) {
          console.log("Response Code: " + jqXHR.status + " - Fehlermeldung: " + jqXHR.responseText);
          $("#Farbe").html("Ein Fehler ist aufgetreten");
		});
		
		$.ajax({
          url: "http://localhost:8000/api/farbe/gib/" + ret.f_id_farbe,
          method: "get",
          dataType: "json"
        }).done(function (response) {
      
          for (var obj in response.daten) {
            if (obj != "preis") {
              var textnode = document.createTextNode(response.daten.name);
              var item = document.getElementById("myList1").childNodes[3];
              
            } else {
              var price = response.daten[obj].toString();
              price = response.daten.name+ "\n Preis: " + price + "€";
              
              var textnode = document.createTextNode(price);
              var item = document.getElementById("myList1").childNodes[2];
               item.replaceChild(textnode, item.childNodes[0]);
              
            }
          };
       

        }).fail(function (jqXHR, statusText, error) {
          console.log("Response Code: " + jqXHR.status + " - Fehlermeldung: " + jqXHR.responseText);
          $("#Farbe").html("Ein Fehler ist aufgetreten");
        });

		$.ajax({
          url: "http://localhost:8000/api/sportfelgen/gib/" + ret.f_id_felgen,
          method: "get",
          dataType: "json"
        }).done(function (response) {
          
          for (var obj in response.daten) {
            if (obj != "preis") {
              var textnode = document.createTextNode(response.daten.hersteller);
              var item = document.getElementById("myList1").childNodes[0];
            } else {
              var price = response.daten[obj].toString();
              price = response.daten.hersteller+ "\n Preis: " + price + "€";
              
              var textnode = document.createTextNode(price);
              var item = document.getElementById("myList1").childNodes[5];
               item.replaceChild(textnode, item.childNodes[0]);

             
            }
           
          };
        }).fail(function (jqXHR, statusText, error) {
          console.log("Response Code: " + jqXHR.status + " - Fehlermeldung: " + jqXHR.responseText);
          $("#Felgen").html("Ein Fehler ist aufgetreten");
        });

		$.ajax({
          url: "http://localhost:8000/api/update/gib/" + ret.f_id_update,
          method: "get",
          dataType: "json"
        }).done(function (response) {

          for (var obj in response.daten) {
            if (obj != "preis") {
              var textnode = document.createTextNode(response.daten.name);
              var item = document.getElementById("myList1").childNodes[0];
            } else {
              var price = response.daten[obj].toString();
              price = response.daten.name+ "\n Preis: " + price + "€";
              
              var textnode = document.createTextNode(price);
              var item = document.getElementById("myList1").childNodes[6];
               item.replaceChild(textnode, item.childNodes[0]);
            }
           
          };
        }).fail(function (jqXHR, statusText, error) {
          console.log("Response Code: " + jqXHR.status + " - Fehlermeldung: " + jqXHR.responseText);
          $("#update").html("Ein Fehler ist aufgetreten");
		});
		

		$.ajax({
          url: "http://localhost:8000/api/config/getPreis/" + ret.id,
          method: "get",
          dataType: "json"
        }).done(function (response) {
          for (var obj in response.daten) {
            if (obj != "preis") {
              var textnode = document.createTextNode(response.daten.name);
              var item = document.getElementById("myList1").childNodes[0];
            } else {
              var price = response.daten[obj].toString();
              price =  "Endpreis: " + price + "€";
              var textnode = document.createTextNode(price);
              var item = document.getElementById("myList1").childNodes[7];
               item.replaceChild(textnode, item.childNodes[0]);
            }
          };
        }).fail(function (jqXHR, statusText, error) {
          console.log("Response Code: " + jqXHR.status + " - Fehlermeldung: " + jqXHR.responseText);
          $("#update").html("Ein Fehler ist aufgetreten");
        });

	}
	setTimeout(ajaxFn,500);
	function link(){
      setCockieWaren();
      window.open('Bestellbestaetigung.html','_self',false);
    }

    $("#Event_button").click(function () {

     
      
      var name = document.getElementById('name').value;
      var vname = document.getElementById('vname').value;
      var email = document.getElementById('email').value;
      var adr = document.getElementById('adr').value;
      var plz = document.getElementById('plz').value;
      var ort = document.getElementById('Ort').value;
      
      var obj = { "f_id_config": ret.id, "name": name, "vname": vname, "email": email, "adr": adr, "plz": parseInt(plz), "ort": ort };

      if(name.length>=3 &&vname.length>=3 &&email.length >=6 && email.includes("@",2) && email.includes(".") ){
        console.log("Erfolgreich")
        $.ajax({
          url: "http://localhost:8000/api/config_besteller",
          method: "post",
          contentType: "application/json",
          data: JSON.stringify(obj)
        }).done(function (response) {
          console.log(response);
          $("#output").html(JSON.stringify(response));
        }).fail(function (jqXHR, statusText, error) {
          console.log("Response Code: " + jqXHR.status + " - Fehlermeldung: " + jqXHR.responseText);
          $("#output").html("Ein Fehler ist aufgetreten");
        });
        setTimeout(link, 500);
        
      }else{
       alert("Eingabe Falsch. Name, Vorname oder Mail sind zu kurz oder nicht vorhanden.")
      }
    });


	});
	

  </script>
</body>

</html>